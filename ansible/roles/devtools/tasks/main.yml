---
- name: Devtools | Apply mode defaults (opinionated)
  ansible.builtin.set_fact:
    devtools_enable_containers: "{{ true if devtools_mode in ['full', 'work'] else devtools_enable_containers }}"
    devtools_enable_admin: "{{ true if devtools_mode in ['full', 'work'] else devtools_enable_admin }}"
    devtools_enable_lang: "{{ true if devtools_mode in ['full', 'work'] else devtools_enable_lang }}"
  when: devtools_mode != 'core'

- name: Devtools | Compute package selection
  ansible.builtin.set_fact:
    _devtools_pacman: >-
      {{
        (devtools_pacman_core | default([]))
        + ((devtools_pacman_lang | default([])) if (devtools_enable_lang | bool) else [])
        + ((devtools_pacman_containers | default([])) if (devtools_enable_containers | bool) else [])
        + ((devtools_pacman_admin | default([])) if (devtools_enable_admin | bool) else [])
        + ((devtools_pacman_tex_base | default([])) if (devtools_enable_tex | bool) else [])
        + ((devtools_pacman_tex_extra | default([])) if (devtools_enable_tex_extra | bool) else [])
        + ((devtools_pacman_work | default([])) if (devtools_mode in ['work', 'full']) else [])
        + (devtools_extra_pacman | default([]))
      }}
    _devtools_aur: >-
      {{
        (devtools_aur_core | default([]))
        + (devtools_extra_aur | default([]))
      }}
    _devtools_flatpak: "{{ devtools_extra_flatpak | default([]) }}"

- name: Devtools | Install selected packages
  ansible.builtin.include_role:
    name: packages
    tasks_from: install.yml
  vars:
    packages_pacman_packages: "{{ _devtools_pacman | unique }}"
    packages_aur_packages: "{{ _devtools_aur | unique }}"
    packages_flatpak_packages: "{{ _devtools_flatpak | unique }}"
